---
# Author: Mammadov Elbrus
  - name: "Playing with Ansible"
    hosts: localhost
    connection: local 
    tasks:

  - name: Run Terraform tasks
    shell: "terraform init -upgrade && terraform plan && terraform apply --auto-approve"
    register: "output"

  - debug: var=output.stdout_lines

  - name: Configure kubectl
    shell: "aws eks --region $(terraform output -raw region) update-kubeconfig --name $(terraform output -raw cluster_name)"
    register: "kubeout"

  - debug: var=kubeout.stdout_lines
  
  - name: Check Kubernetes(EKS)
    shell: eksctl get cluster
    register: "kubecheck"

  - debug: var=kubecheck.stdout_lines

